from Standard.Base import all

from Standard.Table import Aggregate_Column

from Standard.Database.Data.SQL import SQL_Type, Statement
import Standard.Database.Data.Dialect
import Standard.Database.Internal.Postgres.Postgres_Dialect
import Standard.Database.Internal.Base_Generator

## PRIVATE

   The dialect for Redshift connections.
redshift : Dialect
redshift =
    Redshift_Dialect_Data Postgres_Dialect.make_internal_generator_dialect

# TODO Dubious constructor export
from project.Internal.Redshift.Redshift_Dialect.Redshift_Dialect import all
from project.Internal.Redshift.Redshift_Dialect.Redshift_Dialect export all

## PRIVATE

   The dialect for Redshift connections.
type Redshift_Dialect
    ## PRIVATE

       The dialect for Redshift connections.
    Redshift_Dialect_Data internal_generator_dialect

    ## PRIVATE
       Name of the dialect.
    name : Text
    name self = "redshift"

    ## PRIVATE
       A function which generates SQL code from the internal representation
       according to the specific dialect.
    generate_sql : Query -> Statement
    generate_sql self query =
        Base_Generator.generate_query self.internal_generator_dialect query . build

    ## PRIVATE
       Deduces the result type for an aggregation operation.

       The provided aggregate is assumed to contain only already resolved columns.
       You may need to transform it with `resolve_aggregate` first.
    resolve_target_sql_type : Aggregate_Column -> SQL_Type
    resolve_target_sql_type self aggregate =
        Postgres_Dialect.resolve_target_sql_type aggregate

    ## PRIVATE
       Prepares an ordering descriptor.

       One of the purposes of this method is to verify if the expected ordering
       settings are supported by the given database backend.
    prepare_order_descriptor : IR.Internal_Column -> Sort_Direction -> Text_Ordering -> IR.Order_Descriptor
    prepare_order_descriptor self internal_column sort_direction text_ordering =
        Postgres_Dialect.make_order_descriptor internal_column sort_direction text_ordering
