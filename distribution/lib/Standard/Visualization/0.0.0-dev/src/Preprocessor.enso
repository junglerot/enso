from Standard.Base import all
import project.Helpers

## PRIVATE

   Default visualization preprocessor.
default_preprocessor x = x.to_default_visualization_data

## PRIVATE

   Error visualization preprocessor.
error_preprocessor x =
    ok = '{ message: ""}'
    result = x.map_error err->
        message = err.to_display_text
        stack_trace = x.get_stack_trace_text.if_nothing "" . split '\n'
        full_message = message + if stack_trace.length > 1 then " (" + stack_trace.at 1 . trim +")" else ""
        '{ "kind": "Dataflow", "message": ' + full_message.to_json.to_text + '}'
    if result.is_error then result.catch else ok
